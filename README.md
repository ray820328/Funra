# Funra
- 游戏服务器框架，服务轻量级实现，致力于完成一个强实用性，高可维护的分布式框架系统。
- Light weight backend framework of game.

# 前言
忙忙碌碌拧螺丝，一直在各种项目中徘徊，终于还是下决心写点按自己想法的东西了。
* 关于项目，不写太多服务逻辑进程，仅写框架部分；
* 关于代码实现，尽量简洁，尽量实现成可模块替换；
* 关于IPC，考虑部署的局限性，主要以Socket实现，
优化阶段根据实际需要，封装mmap或共享内存实现，优化同一VM环境下部署的多进程之间的通信效率；
* 关于分布式数据存储，暂不涉及分布式算法实现，间接使用第三方服务实现AP和最终一致性，
服务发现和Meta分布式数据管理采用Consul，业务数据存储采用MongoDB分片副本集集群；
* 关于语言，为了与工作剥离，以c为主，脚本以lua为主；
* 关于跨平台，因时间有限目前仅准备提供x86-64 & Linux版本（CentOS 7）；

因为时间和精力有限，纰漏和错误之处在所难免，希望不吝赐教，再此提前感谢。

# 设计思路
- 针对业务数据特点，服务进程设计为有状态服务器和无状态服务器两种；
- 有状态服务器允许一定时间范围的热数据丢失，如场景服务器崩溃丢失场景当前未存盘的npc状态数据；

# 计划
目前计划分几个阶段，因只有非工作时间可以开发，每阶段计划三个月左右，
阶段不一定严格按顺序执行，存在部分交叉开发，目前计划三年左右时间完成。
* 项目初始化，基本类库，基础脚本整理；
* 网络和rpc实现部分；
* 基础接口和模块实现；
* 集群，分布式和负载均衡部分；
* 尽可能的网络和接口压力测试，可能会延迟维护接口单元测试；
* 一个基于Funra框架的Demo小游戏；
* 性能分析和优化，包括同VM内IPC方案优化等；

大方向基本不变，其余怎么方便怎么来了。

# 关于编码
- 一切命名以简单明了为宗旨，旧文件和第三方库保持不变，新文件尽量遵守以下规则；
- 文件统一utf8不带bom；
- c代码，文件名统一小写，宏和函数名小写 + 下划线分隔，变量名首字母小写驼峰，一般不带变量类型，宏可能带macro前后缀；
- lua代码，文件名和函数都驼峰并大写首字母，变量名驼峰并加类型前缀（n/sz/tb/em），Chunk变量以单下划线'\_'开始；
- 未统一部分在合适的时候可能会做调整；
- 编码质量控制，后期Coverity做静态代码检测，集成测试尽量多跑Valgrind；

# 关于测试
- 有限的单元和性能测试；
- 单元测试可能会延迟维护；
- 接口单元测试和性能测试可能会混在一起，后期有时间再整理；
- 集成压力测试视后期工具和环境进行；

# 问题和解决
- 因Funra用到多线程和lua脚本，曾经项目中重度lua逻辑，heap内存使用ptmalloc分配，
sbrk高并发环境下导致top chunk激增，内存碎片引起rss不能释放问题，本框架生产环境直接使用jemalloc，后续不做过多解释；

# 后记
留空，希望以后能开心的来写这里。
这就开始...

# Thanks
All codes mentioned.

# LICENSE
Funra project is under the license of MIT. See the LICENSE for details plz.
